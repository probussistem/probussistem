<!DOCTYPE html>
<html>
    <head>

        <meta property="og:title" content="Probus System Vesrsion controll" />
        <meta property="og:url" content="https://probussistem.github.io" />
        <meta property="og:image" content="https://i.postimg.cc/85c5rvjX/icon.png" />
        <meta property="og:description" content="probus system mobile app development controll version log" />
        <meta property="og:site_name" content="peobus system" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Vesrsion Controll</title>
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link href="https://fonts.googleapis.com/css?family=Roboto:300&display=swap" rel="stylesheet">
        <script src="https://www.gstatic.com/firebasejs/5.10.1/firebase-app.js"></script>
        <!-- Add Firebase products that you want to use -->
        <script src="https://www.gstatic.com/firebasejs/5.10.1/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.10.1/firebase-database.js"></script>

        <!-- jquery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <!-- markdown -->
        <script src="dist/js/md.js"></script>
        <link rel="stylesheet" href="dist/css/main.css">

       <style>
            h*{
                font-family: 'Roboto', sans-serif;
            }
            .w3-container{
                padding:0px;
            }

            html {
                overflow: scroll;
                overflow-x: hidden;
            }
            ::-webkit-scrollbar {
                width: 0px;  /* Remove scrollbar space */
                background: transparent;  /* Optional: just make scrollbar invisible */
            }
            /* Optional: show position indicator in red */
            ::-webkit-scrollbar-thumb {
                background: #FF0000;
            }
            .mc{
                position: fixed; 
                top: 10%;
                left: 10%;
                bottom: 10%;
                width: 80%;
                height: 80%;
                overflow: scroll;
                z-index: 100;
            }
            #editor{
                position: fixed;
                top: 10%;
                left: 10%;
                width: 80%;
                bottom: 10%;
                height: 80%;
                overflow: scroll;
                z-index: 0;
            }
            .padding-kanan{
                padding-left: 16px;
            }
            
        </style>
    </head>
    <body class="w3-light-grey">
        <div class="w3-large w3-blue w3-input" >Malik kurosaki
            <div id="baru" class="w3-right w3-button">new</div>
        </div>
        <div class="w3-container w3-padding">
            <div class="w3-half ">
                <div class="w3-container w3-center">Change Log</div>
                <div id="main" class="w3-container w3-white w3-input w3-border-right" style="overflow: scroll"></div>
                <div id="mc" class="mc w3-container w3-content w3-round w3-border w3-white w3-card">
                    <div id="close1" class=" w3-red w3-round w3-right w3-button ">X</div>
                    <div class="muncul w3-white w3-container w3-padding" style="width:100%;height: 100%;z-index:-1;overflow: scroll" id="muncul"></div>
                    <div class="w3-container w3-padding">
                        <input id="ket" class="w3-input w3-light-grey" placeholder="keterangan">
                    </div>
                    <div class="w3-container w3-padding">
                        <input id="jdl" placeholder="judul" class="w3-quarter w3-input w3-light-grey"><input id="kat" placeholder="kategori" class="w3-quarter w3-input w3-light-grey" ><input id="tag" placeholder="tag" class="w3-quarter w3-input w3-light-grey">
                        <div id="save1" class="w3-input w3-button w3-blue w3-quarter">save</div>
                    </div>
                </div>
                <div id="editor" class="w3-container w3-content w3-white w3-round w3-border">
                    <div id="close2" class=" w3-red w3-round w3-right w3-button ">X</div>
                    <div contenteditable="true" id="edit" style="width:100%;height: 100%;z-index:-1;overflow: scroll"  spellcheck="false" class="w3-padding w3-input" ></div>
                    <div class="w3-container">
                        <div class="w3-container w3-third w3-hover-yellow">
                            <label id="gambar1" for="gambar2" class="w3-container w3-padding w3-blue w3-input">gambar</label>
                            <input id="gambar2" class="w3-hide">
                        </div>
                        <div id="markdown" class="w3-right w3-button w3-blue ">markdown</div>
                        <div id="html" class="w3-right w3-button w3-blue ">html</div>
                    </div>
                </div>
            </div>
            <div class="w3-half w3-container ">
                <div class="w3-container w3-center">Kategori</div>
                <div class="w3-container w3-input w3-padding w3-white">
                    <div id="cmenu"></div>
                </div>
            </div>
        </div>
        <script>
            var firebaseConfig = {
                apiKey: "AIzaSyCckvX1DUrHlG6Zh6zVExgLOE_Mr4RANhw",
                authDomain: "probussystem-32ab2.firebaseapp.com",
                databaseURL: "https://probussystem-32ab2.firebaseio.com",
                projectId: "probussystem-32ab2",
                storageBucket: "probussystem-32ab2.appspot.com",
                messagingSenderId: "491305505631",
                appId: "1:491305505631:web:a9cbd55378c7e7ba"
            };
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);

            var db = firebase.database();

            // membaca
            firebase.database().ref("post").on('value',(snapshot)=>{
                var semua = [];
                var kategori = [];
                var kabeh = []
                var tagnya = []
                var kuncinya = []
                var tangganya = []
                for(var a in snapshot.val()){
                    for(var b in snapshot.val()[a]){
                        var datanya = snapshot.val()[a][b];
                            kategori.push(datanya.kategori.trim())
                            tagnya.push(datanya.tag.trim())
                            kuncinya.push(datanya.kunci.trim())
                            tangganya.push(datanya.tanggal.trim)
                            kabeh.push(snapshot.val()[a][b])
                        if(snapshot.val()[a][b].kategori.includes("changelog")){
                            semua.push(snapshot.val()[a][b]);
                        }
                    }
                }

                kategori = [...new Set(kategori)]
                kuncinya = [...new Set(kuncinya)]
                tangganya = [...new Set(tangganya)]
                var ket = ""
                for(var i in kategori){
                    ket += `<details><summary class="w3-button">${kategori[i]}</summary>`
                    for(var y in kabeh){
                        if(kabeh[y].kategori.includes(kategori[i])){
                            ket += `<div><details class="w3-container "><summary class="w3-button w3-blue w3-border-bottom w3-border-white">${kabeh[y].judul}</summary><div class="w3-container w3-padding w3-border">${kabeh[y].isi}</div><div class="w3-tag w3-red w3-container w3-right w3-button w3-padding kunci" onclick="hapus('${kabeh[i].tanggal}/${kabeh[i].kunci}')" >X</div></details></div>`
                        }
                    }
                    ket += `</details>`
                }

                $("#cmenu").html(ket)

                var sm = semua.reverse()
                var kontent = ""
                for(var y in sm){this
                    var isinya = sm[y];
                        kontent +=`<details ><summary class="w3-button">${isinya.judul} > ${isinya.tanggal}</summary><div class="w3-container w3-padding">${isinya.isi}</div> <div class="w3-tag w3-red w3-container w3-right w3-button w3-padding kunci" onclick="hapus('${isinya.tanggal}/${isinya.kunci}')" id="${isinya.kunci}">X</div></details>`;
                }
                $("#main").html(kontent)
            });

            $("#mc").hide();
            $("#editor").hide()

            $("#baru").click(()=>{
                var apa = window.location.href;
                if(apa.includes("#")){
                    var bagi = apa.split("#");
                    if(bagi[1].includes("baru")){
                        $("#editor").show();
                    }else{
                        alert("anda tidak memiliki akses untuk membuat kontent baru")
                    }
                }else{
                    alert("anda tidak memiliki akses untuk membuat kontent baru")
                }
                
            })
            $("#close2").click(()=>{
                $("#editor").hide();
            })

            document.getElementById("markdown").onclick = function(){
                var tex = document.getElementById("edit").innerText.replace(/"/g,"");
                var target = document.getElementById("muncul").innerHTML = marked(tex);
                $("#mc").show();
            }
            document.getElementById("html").onclick = function(){
                var tex = document.getElementById("edit").innerHTML.replace(/<br>/g,"\n");
                var target = document.getElementById("muncul").innerHTML = marked(tex);
                $("#mc").show();
            }

            $("#close1").click(()=>{
                $("#mc").hide();
            })

            $("#save1").click(()=>{

                let tod = new Date().toISOString().slice(0, 10)

                var hsl = $("#muncul").html();
                var ket = $("#ket").val();
                var jdl = $("#jdl").val();
                var kat = $("#kat").val();
                var tg = $("#tag").val();


                if(hsl == "" || ket == "" || jdl == "" || kat == "" || tag == ""){
                    alert("gak bole ad yang kosong")
                }else{
                    var key = firebase.database().ref().child('posts').push().key;
                    db.ref('/post/'+tod+"/"+key).set({
                        isi:hsl,
                        keterangan:ket,
                        kategori:kat,
                        judul:jdl,
                        tag:tg,
                        tanggal:tod,
                        kunci:key
                    },(e)=>{
                        if(e){
                            alert("gagal")
                            $("#mc").hide();
                        }else{
                            alert("berhasil")
                            $("#mc").hide();
                        }
                    })
                }
            })

           function hapus(e){
               var apa = window.location.href;
               if(apa.includes("#")){
                   var bagi = apa.split("#");
                   if(bagi[1].includes("hapus")){
                        db.ref("post/"+e).remove().then(()=>{
                            alert("terhapus")
                        }).catch((e)=>{
                            alert(e.massage)
                        })
                   }else{
                    alert("anda tidak mempunyai ijin untuk menghapusnya")
                   }
               }else{
                   alert("anda tidak mempunyai ijin untuk menghapusnya")
               }
           }


           File.prototype.gamabar = (panggil)=>{
               var reader = new FileReader();
               reader.onload = (e)=>{
                   panggil(e.target.result,e.target.error)
               }
               reader.readAsDataURL(this);
           }

// =============================================================

$("#gambar1").on('dragover',(e)=>{
    e.preventDefault()
    e.stopPropagation()
    e.target.innerHTML = "disini"
}).on('dragleave',(e)=>{
    e.target.innerHTML = "gak jadi??"
    e.preventDefault()
    e.stopPropagation()
})
dropbox = document.getElementById("gambar1");

dropbox.addEventListener("drop",(e)=>{

const dt = e.dataTransfer;
const files = dt.files[0];
e.target.innerHTML = "";

e.stopPropagation();
e.preventDefault();
var reader = new FileReader();
reader.onload = (e)=>{
    var img = document.createElement('img');
    img.setAttribute('src',e.target.result)
    document.getElementById("gambar1").appendChild(img)
}
reader.readAsDataURL(files);
}, false);

$("#gambar1").bind('paste',(e)=>{
    e.target.focus()
    var items = (event.clipboardData || event.originalEvent.clipboardData).items;
    console.log(JSON.stringify(items)); // will give you the mime types
    for (index in items) {
    var item = items[index];
    if (item.kind === 'file') {
        var blob = item.getAsFile();
        var reader = new FileReader();
        reader.onload = function(event){
            var img = document.createElement('img');
            img.setAttribute('src',event.target.result)
            document.getElementById("gambar1").appendChild(img)
        }; 
        reader.readAsDataURL(blob);
    }
    }
})


        </script>


        </body>
</html>
<!DOCTYPE html>
<html>
    <head>
        <meta property="og:title" content="Probus System Vesrsion controll" />
        <meta property="og:url" content="https://probussistem.github.io" />
        <meta property="og:image" content="https://i.postimg.cc/85c5rvjX/icon.png" />
        <meta property="og:description" content="probus system mobile app development controll version log" />
        <meta property="og:site_name" content="peobus system" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Vesrsion Controll</title>
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link href="https://fonts.googleapis.com/css?family=Roboto:300&display=swap" rel="stylesheet">
        <script src="https://www.gstatic.com/firebasejs/5.10.1/firebase-app.js"></script>
        <!-- Add Firebase products that you want to use -->
        <script src="https://www.gstatic.com/firebasejs/5.10.1/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.10.1/firebase-database.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <!-- jquery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <!-- markdown -->
        <script src="dist/js/md.js"></script>
        <link rel="stylesheet" href="dist/css/main.css">
        <link rel="stylesheet" href="dist/css/malik.css">

       <style>
          
        </style>
    </head>
    <body class="w3-container w3-blue-grey">
        <div class="w3-container">
            <div class="w3-container padding-a w3-input w3-margin-bottom w3-card">
                <div class="  w3-container flx w3-blue " >
                    <!-- brand -->
                    <div id="brand" class=" w3-container ">
                        <div class="w3-button w3-xxlarge w3-hide-small">
                            Malik kurosaki
                        </div>
                        <div class="w3-button w3-hide-large">
                            Malik kurosaki
                        </div>
                    </div>
                    <!-- cari -->
                    <div id="cari" class="w3-container w3-blue">
                        <input id="mencari" class=" w3-container w3-white w3-input padding-kanan  w3-round" placeholder="cari" list="carilist">
                    </div>
                    <!-- <div  class=" w3-container w3-padding">
                        <div id="baru" class="w3-right w3-button w3-right">new</div>
                    </div> -->
                </div>
            </div>
            <!-- story -->
            <div class="w3-container w3-content w3-margin-bottom w3-card" >
                <div class="w3-container">
                    
                </div>
                <div id="story" class="w3-container w3-input w3-white w3-padding w3-border w3-border-white" >

                </div>
            </div>
            <div class="w3-container padding4 ">
                <!-- kategori -->
                <div class=" w3-container w3-content w3-margin-bottom w3-card w3-mobile w3-border w3-border-white">
                    <div class="w3-container  w3-padding">Kategori</div>
                    <div class="w3-container w3-input w3-white w3-card">
                        <div id="cmenu" class="w3-padding"></div>
                    </div>
                </div>
                <div class=" w3-container w3-content w3-margin-bottom w3-card w3-mobile w3-border w3-border-white">
                    <div class="w3-container  w3-padding">Change Log Version Controll Probus System App</div>
                    <!-- main -->
                    <div id="main" class="w3-container w3-padding w3-white w3-input w3-border-right w3-card" style="overflow: scroll"></div>
                </div>
                
            </div>
        </div>
        <div class="w3-container">
            <!-- editor -->
            <div id="editor" class="w3-container w3-white w3-round w3-border w3-card">
                <div class="w3-container flk2 w3-padding w3-blue">
                    <div class="w3-container">Editor</div>
                    <div class="w3-container">
                        <div id="close2" class=" w3-red w3-right w3-button w3-padding w3-right">X</div>
                        <div id="pulihkan" class=" w3-green w3-right w3-button w3-padding w3-right">pulihkan</div>
                    </div>
                </div>
                
                <div contenteditable="true" id="edit" style="width:100%;height: 100%;z-index:-1;overflow: scroll"  spellcheck="false" class="w3-padding w3-input" ></div>
                <div class="w3-container">
                    <div class="w3-container w3-third w3-hover-yellow">
                        <label id="gambar1" for="gambar2" class="w3-container w3-padding w3-blue w3-input">gambar</label>
                        <input id="gambar2" class="w3-hide">
                    </div>
                    <div id="markdown" class="w3-right w3-button w3-blue ">markdown</div>
                    <div id="html" class="w3-right w3-button w3-blue w3-border-white w3-border-right">html</div>
                </div>
            </div>
            <!-- save -->
            <div id="mc" class="mc w3-container  w3-round w3-border w3-white w3-card">
                <div class="w3-container w3-red">
                    <div class=" w3-center w3-col s11 w3-xlarge">Save</div>
                    <div id="close1" class="w3-col s1">
                        <div class="w3-right w3-button w3-red w3-padding">X</div>
                    </div>
                </div>
                <div class="muncul w3-white w3-container w3-padding" style="width:100%;height: 100%;z-index:-1;overflow: scroll" id="muncul"></div>
                <div class="w3-container">
                    <input id="ket" class="w3-input w3-light-grey" placeholder="keterangan">
                </div>
                <div class="w3-container ">
                    <div id="" class="w3-quarter w3-light-grey">
                        <input id="jdl" placeholder="judul" class="w3-input">
                    </div>
                    <div id="katnya" class="w3-quarter w3-light-grey">
                        <input id="kat" placeholder="kategori" list="kategori" class=" w3-input" >
                    </div>
                    <div id="thetag" class="w3-quarter w3-light-grey">
                        <input id="tag" placeholder="tag" class="w3-input" list="taglist">
                    </div>
                    <div id="save1" class="w3-input w3-button w3-blue w3-quarter">save</div>
                    <div id="update" class="w3-input w3-button w3-green w3-quarter">Update</div>
                </div>
            </div>
        </div>
        <!-- hasil cari -->
        <div id="hasilCari" class="w3-container w3-card w3-white w3-input w3-border">
            <div id="closehasil" class="w3-button w3-padding w3-red w3-right">X</div>
            <div id="isiCari" class="w3-padding" style="overflow:auto "></div>
        </div>
        <!-- loading -->
        <div id="loading" class="lds-hourglass w3-blue w3-circle"></div>
        <footer class=" w3-bottom">
            <code class="w3-blue-grey">malikkurosaki @2019 </code> 
            <a href="https://github.com/markedjs/marked">markdown js</a> | 
            <a href="https://opensource.com/article/19/4/history-mit-license">MIT license</a> | 
            <a href="https://www.w3schools.com/w3css/default.asp">w3 css</a> | 
            <a href="https://jquery.com/">jquery</a>
        </footer>
        <script>
            $('#hasilCari').hide()
            $("#update").hide()
            var firebaseConfig = {
                apiKey: "AIzaSyCckvX1DUrHlG6Zh6zVExgLOE_Mr4RANhw",
                authDomain: "probussystem-32ab2.firebaseapp.com",
                databaseURL: "https://probussystem-32ab2.firebaseio.com",
                projectId: "probussystem-32ab2",
                storageBucket: "probussystem-32ab2.appspot.com",
                messagingSenderId: "491305505631",
                appId: "1:491305505631:web:a9cbd55378c7e7ba"
            };
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);

            var db = firebase.database();
            $('#brand').click(()=>{
                window.location.reload();
            })
            // membaca
            firebase.database().ref("post").on('value',(snapshot)=>{
                var semua = [];
                var kategori = [];
                var kabeh = []
                var tagnya = []
                var kuncinya = []
                var tangganya = []
                var judulnya = [];
                var storynya = [];
                for(var a in snapshot.val()){
                    for(var b in snapshot.val()[a]){
                        var datanya = snapshot.val()[a][b];
                            kategori.push(datanya.kategori.trim())
                            judulnya.push(datanya.judul.trim())
                            tagnya.push(datanya.tag.trim())
                            kuncinya.push(datanya.kunci.trim())
                            tangganya.push(datanya.tanggal.trim)
                            kabeh.push(snapshot.val()[a][b])

                        if(snapshot.val()[a][b].kategori.includes("changelog")){
                            semua.push(snapshot.val()[a][b]);
                        }
                        if(datanya.kategori.includes("story")){
                            storynya.push(datanya);
                        }
                    }
                }

                // menampilkan story
                if(storynya.length != 0){
                    var storyIsi = `<details class="w3-container"><summary  class="w3-padding w3-blue w3-center w3-round w3-button w3-cell"><h2>${storynya.sort()[0].judul}</h2><div class="w3-container w3-padding kebawah" >${storynya.sort()[0].keterangan}</div></summary><div class="over w3-container">${storynya.sort()[0].isi}</div></details>`
                    $('#story').html(storyIsi)
                }
                
                // penampilan search / cari
                
                var detailCari = "";
                    detailCari += `<datalist id="carilist">`
                for(var j =0;j<judulnya.length;j++){
                    //console.log(judulnya[j])
                    detailCari +=`<option value="${judulnya[j]}">`
                }
                    detailCari +=`</datalist>`
                $("#cari").append(detailCari)

                $("#cari").change(()=>{
                    const hasilnya = $("#mencari").val();
                    if(hasilnya.trim() != " " || hasilnya.trim() != ""){
                        var maka = "";
                        var berapa = []
                        for(var k=0;k<kabeh.length;k++){
                            if(kabeh[k].judul.includes(hasilnya)){
                                maka += `<details><summary class="w3-button">${kabeh[k].judul}</summary><div class="w3-container w3-padding" style="overflow:auto">${kabeh[k].isi}</div></details>`
                                berapa.push(kabeh[k].judul)
                            }
                        }
                        if(berapa.length != 0){
                            $('#hasilCari').show()
                            $('#isiCari').html(maka)
                        }else{
                            alert("data tidak ada")
                        }
                       
                    }else{
                        alert("nakal ngejak guyon")
                    }
                    
                })

                $("#closehasil").click(()=>{
                    $('#hasilCari').hide()
                })


                // menu kategory
                kategori = [...new Set(kategori)]
                tagnya = [...new Set(tagnya)]
                kuncinya = [...new Set(kuncinya)]
                tangganya = [...new Set(tangganya)]
                var ket = ""
                var sugest = `<datalist id="kategori">`
                var sugestTag = `<datalist id="taglist">`
                for(var i in kategori){
                    sugest += `<option value="${kategori[i]}">`
                    sugestTag += `<option value="${tagnya[i]}">`
                    ket += `<details><summary class="w3-button">${kategori[i]}</summary>`
                    for(var y in kabeh){
                        if(kabeh[y].kategori.includes(kategori[i])){
                            ket += `<div><details class="w3-container "><summary class="w3-button w3-blue w3-border-bottom w3-border-white">${kabeh[y].judul}</summary><div class="w3-container w3-border"><div class="w3-container w3-padding nyecrol" >${kabeh[y].isi}</div><div class="w3-tag w3-red w3-container w3-right w3-button w3-padding kunci busek" onclick="hapus('${kabeh[y].tanggal}/${kabeh[y].kunci}')" >X</div><div class="w3-tag w3-green w3-container w3-right w3-button w3-padding ngedit" onclick="ngedit('${kabeh[y].tanggal}/${kabeh[y].kunci}')" >/</div></div></details></div>`
                        }
                    }
                    ket += `</details>`
                }
                sugest += `</datalist>`
                sugestTag +=`</datalist>`
                $('#katnya').append(sugest)
                $('#thetag').append(sugestTag)
                $("#cmenu").html(ket)

                var sm = semua.reverse()
                var kontent = ""
                for(var y in sm){this
                    var isinya = sm[y];
                        kontent +=`<details ><summary class="w3-button">${isinya.judul} > ${isinya.tanggal}</summary><div class="w3-container w3-padding">${isinya.isi}</div> <div class="w3-tag w3-red w3-container w3-right w3-button w3-padding kunci busek" onclick="hapus('${isinya.tanggal}/${isinya.kunci}')" id="${isinya.kunci}">X</div></details>`;
                }
                $("#main").html(kontent)
                $('#loading').hide()

                firebase.database().ref("setting").on('value',(snapshot)=>{
                    var busek = document.getElementsByClassName("busek");
                    var ed = document.getElementsByClassName("ngedit");
                    var apa = window.location.href;
                    if(apa.includes(snapshot.val().hapus)){
                        $(".busek").show()
                        $(".ngedit").hide()
                        
                    }else if(apa.includes(snapshot.val().edit)){
                        $(".ngedit").show()
                        $(".busek").hide()
                    } else{
                        $(".busek").hide()
                        $(".ngedit").hide()
                    }
                })
            });

            function munculkan(a,b){
                var nodenya = document.getElementsByClassName(a);
                for(var n = 0; n<nodenya.length;n++){
                    if(b){
                        nodenya[n].style.display = "block"
                    }else{
                        nodenya[n].style.display = "block"
                    }
                    
                }
            }

            $("#mc").hide();
            $("#editor").hide()

            $("#baru").click(()=>{
                alert("hayo , mau apa .. ?")
            })

            firebase.database().ref("setting").on('value',(snapshot)=>{

                var apa = window.location.href;
                if(apa.includes(snapshot.val().baru)){
                    $("#editor").show();
                }else{
                    $("#editor").hide();
                }

                $("#close2").click(()=>{
                    $("#editor").hide();
                })
            })
            // markdown show
            document.getElementById("markdown").onclick = function(){
                var tex = document.getElementById("edit").innerText.replace(/"/g,"");
                var target = document.getElementById("muncul").innerHTML = marked(tex);
                $("#mc").show();
            }

            // html show
            document.getElementById("html").onclick = function(){
                var tex = document.getElementById("edit").innerHTML.replace(/<br>/g,"\n");
                var target = document.getElementById("muncul").innerHTML = marked(tex);
                $("#mc").show();
            }

            $("#close1").click(()=>{
                $("#mc").hide();
            })

            //simpan
            $("#save1").click(()=>{
                let tod = new Date().toISOString().slice(0, 10)

                var hsl = $("#muncul").html();
                var ket = $("#ket").val();
                var jdl = $("#jdl").val();
                var kat = $("#kat").val();
                var tg = $("#tag").val();


                if(hsl == "" || ket == "" || jdl == "" || kat == "" || tag == ""){
                    alert("gak bole ad yang kosong")
                }else{
                    var key = firebase.database().ref().child('posts').push().key;
                    db.ref('/post/'+tod+"/"+key).set({
                        isi:hsl,
                        keterangan:ket,
                        kategori:kat,
                        judul:jdl,
                        tag:tg,
                        tanggal:tod,
                        kunci:key
                    },(e)=>{
                        if(e){
                            alert("gagal")
                            $("#mc").hide();
                            $("#editor").hide()
                        }else{
                            alert("berhasil")
                            $("#mc").hide();
                            $("#editor").hide()
                        }
                    })
                }
            })

            // hapus
           function hapus(e){
               var apa = window.location.href;
               if(apa.includes("#")){
                   var bagi = apa.split("#");
                   if(bagi[1].includes("hapus")){
                        db.ref("post/"+e).remove().then(()=>{
                            alert("terhapus")
                        }).catch((e)=>{
                            alert(e.massage)
                        })
                   }else{
                    alert("anda tidak mempunyai ijin untuk menghapusnya")
                   }
               }else{
                   alert("anda tidak mempunyai ijin untuk menghapusnya")
               }
           }

           // ngedit

           function ngedit(e){
                $("#editor").show()
                $("#update").show()
               firebase.database().ref("post/"+e).once('value').then((snapshot)=>{
                    $("#edit").html(snapshot.val().isi)
                    $("#ket").val(snapshot.val().keterangan)
                    $("#jdl").val(snapshot.val().judul)
                    $("#kat").val(snapshot.val().kategori)
                    $("#ket").val(snapshot.val().keterangan)
                    $("#tag").val(snapshot.val().tag)

                    $("#save1").hide()
                    $("#update").click(()=>{

                        const postData = {
                            isi:$("#muncul").html(),
                            keterangan:$("#ket").val(),
                            kategori:$("#kat").val(),
                            judul:$("#jdl").val(),
                            tag:$("#tag").val(),
                            tanggal:snapshot.val().tanggal,
                            kunci:snapshot.val().kunci
                        }

                        firebase.database().ref("post/"+e).set(postData,(err)=>{
                            if(err){
                                alert("gagal"+err)
                                $("#mc").hide();
                                $("#editor").hide()
                            }else{
                                alert("berhasil")
                                $("#mc").hide();
                                $("#editor").hide()
                            }
                        })
                    })
               })
           }

        $("#edit").keypress((e)=>{
            var key = e.which;
            if(key == 13)  // the enter key code
            {
                firebase.database().ref("tmp/editor").set({
                editor:e.target.innerHTML
                },(err)=>{
                    if(err){
                        alert("koneksi error")
                    }else{

                    }
                })
            }
            

            
        })
        $("#pulihkan").click(()=>{
            firebase.database().ref("tmp/editor").once('value').then((snapshot)=>{
                $("#edit").html(snapshot.val().editor)
            })
        })

           File.prototype.gamabar = (panggil)=>{
               var reader = new FileReader();
               reader.onload = (e)=>{
                   panggil(e.target.result,e.target.error)
               }
               reader.readAsDataURL(this);
           }

// =============================================================

$("#gambar1").on('dragover',(e)=>{
    e.preventDefault()
    e.stopPropagation()
    e.target.innerHTML = "disini"
}).on('dragleave',(e)=>{
    e.target.innerHTML = "gak jadi??"
    e.preventDefault()
    e.stopPropagation()
})
dropbox = document.getElementById("gambar1");

dropbox.addEventListener("drop",(e)=>{

const dt = e.dataTransfer;
const files = dt.files[0];
e.target.innerHTML = "";

e.stopPropagation();
e.preventDefault();
var reader = new FileReader();
reader.onload = (e)=>{
    var img = document.createElement('img');
    img.setAttribute('src',e.target.result)
    document.getElementById("gambar1").appendChild(img)
}
reader.readAsDataURL(files);
}, false);

$("#gambar1").bind('paste',(e)=>{
    e.target.focus()
    var items = (event.clipboardData || event.originalEvent.clipboardData).items;
    //console.log(JSON.stringify(items)); // will give you the mime types
    for (index in items) {
    var item = items[index];
    if (item.kind === 'file') {
        var blob = item.getAsFile();
        var reader = new FileReader();
        reader.onload = function(event){
            var img = document.createElement('img');
            img.setAttribute('src',event.target.result)
            document.getElementById("gambar1").appendChild(img)
        }; 
        reader.readAsDataURL(blob);
    }
    }
})


        </script>


        </body>
</html>